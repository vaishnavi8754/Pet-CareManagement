{
    "sourceFile": "server/Controller/PetController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1734615625349,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1734617122266,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,9 +46,9 @@\n     const mailOptions = {\n       from: process.env.EMAIL_USER,\n       to: email,\n       subject: 'Pet Submission Received - PetAdopt',\n-      text: `Dear ${status === 'HomePet' ? name : posterName},\\n\\nThank you for submitting your pet to PawFinds.\\n\\nWe have received your request, and our admin team is reviewing it. Once approved, your listing will be live on our platform.\\n\\nWe appreciate your patience and will notify you once your pet's listing is live.\\n\\nBest regards,\\nThe PawFinds Team`,\n+      text: `Dear ${status === 'Home Pet' ? name : posterName},\\n\\nThank you for submitting your pet to PawFinds.\\n\\nWe have received your request, and our admin team is reviewing it. Once approved, your listing will be live on our platform.\\n\\nWe appreciate your patience and will notify you once your pet's listing is live.\\n\\nBest regards,\\nThe PawFinds Team`,\n     };\n \n     try {\n       await transporter.sendMail(mailOptions);\n@@ -83,9 +83,9 @@\n     const mailOptions = {\n       from: process.env.EMAIL_USER,\n       to: pet.email,\n       subject: 'Your Pet is Now Live on PetAdopt!',\n-      text: `Dear ${pet.status === 'HomePet' ? pet.name : pet.posterName} Owner,\\n\\nGreat news! Your pet has been approved and is now live on the PawFinds platform.\\n\\nPet lovers in our community can now view and adopt your pet. Thank you for contributing to our community.\\n\\nBest regards,\\nThe PawFinds Team`,\n+      text: `Dear ${pet.status === 'Home Pet' ? pet.name : pet.posterName} Owner,\\n\\nGreat news! Your pet has been approved and is now live on the PawFinds platform.\\n\\nPet lovers in our community can now view and adopt your pet. Thank you for contributing to our community.\\n\\nBest regards,\\nThe PawFinds Team`,\n     };\n \n     try {\n       await transporter.sendMail(mailOptions);\n"
                },
                {
                    "date": 1734617961872,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,10 @@\n     const { name, age, area, justification, email, phone, type, status, location, posterName, daysInLocation } = req.body;\n     const { filename } = req.file;\n \n     const petData = {\n+      name,\n+      age,\n       area,\n       email,\n       phone,\n       type,\n"
                }
            ],
            "date": 1734615625349,
            "name": "Commit-0",
            "content": "const Pet = require('../Model/PetModel');\nconst fs = require('fs');\nconst path = require('path');\nconst nodemailer = require('nodemailer');\n\nconst postPetRequest = async (req, res) => {\n  try {\n    const { name, age, area, justification, email, phone, type, status, location, posterName, daysInLocation } = req.body;\n    const { filename } = req.file;\n\n    const petData = {\n      area,\n      email,\n      phone,\n      type,\n      filename,\n      location ,\n      daysInLocation,\n      posterName,\n      justification,\n      status: status || 'Pending',\n    };\n\n    if (status === 'Home Pet') {\n      petData.name = name;\n      petData.age = age;\n      petData.type = type;\n      petData.location = location;\n      petData.justification = justification;\n    } else if (status === 'Homeless Pet') {\n      petData.posterName = posterName;\n      petData.daysInLocation = daysInLocation;\n      petData.location = location;\n    }\n\n    const pet = await Pet.create(petData);\n\n    const transporter = nodemailer.createTransport({\n      service: 'gmail',\n      auth: {\n        user: process.env.EMAIL_USER,\n        pass: process.env.EMAIL_APP_PASS,\n      },\n    });\n\n    const mailOptions = {\n      from: process.env.EMAIL_USER,\n      to: email,\n      subject: 'Pet Submission Received - PetAdopt',\n      text: `Dear ${status === 'HomePet' ? name : posterName},\\n\\nThank you for submitting your pet to PawFinds.\\n\\nWe have received your request, and our admin team is reviewing it. Once approved, your listing will be live on our platform.\\n\\nWe appreciate your patience and will notify you once your pet's listing is live.\\n\\nBest regards,\\nThe PawFinds Team`,\n    };\n\n    try {\n      await transporter.sendMail(mailOptions);\n    } catch (error) {\n      console.error('Error sending submission email:', error);\n    }\n\n    res.status(200).json(pet);\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n};\n\nconst approveRequest = async (req, res) => {\n  try {\n    const id = req.params.id;\n    const { email, phone, status } = req.body;\n    const pet = await Pet.findByIdAndUpdate(id, { email, phone, status }, { new: true });\n\n    if (!pet) {\n      return res.status(404).json({ error: 'Pet not found' });\n    }\n\n    const transporter = nodemailer.createTransport({\n      service: 'gmail',\n      auth: {\n        user: process.env.EMAIL_USER,\n        pass: process.env.EMAIL_APP_PASS,\n      },\n    });\n\n    const mailOptions = {\n      from: process.env.EMAIL_USER,\n      to: pet.email,\n      subject: 'Your Pet is Now Live on PetAdopt!',\n      text: `Dear ${pet.status === 'HomePet' ? pet.name : pet.posterName} Owner,\\n\\nGreat news! Your pet has been approved and is now live on the PawFinds platform.\\n\\nPet lovers in our community can now view and adopt your pet. Thank you for contributing to our community.\\n\\nBest regards,\\nThe PawFinds Team`,\n    };\n\n    try {\n      await transporter.sendMail(mailOptions);\n    } catch (error) {\n      console.error('Error sending approval email:', error);\n    }\n\n    res.status(200).json(pet);\n  } catch (err) {\n    res.status(500).json({ error: err.message });\n  }\n};\n\nconst allPets = async (reqStatus, req, res) => {\n  try {\n    const data = await Pet.find({ status: reqStatus }).sort({ updatedAt: -1 });\n    if (data.length > 0) {\n      res.status(200).json(data);\n    } else {\n      res.status(200).json({ error: 'No data found' });\n    }\n  } catch (err) {\n    res.status(500).json({ error: err.message });\n  }\n};\n\nconst deletePost = async (req, res) => {\n  try {\n    const id = req.params.id;\n    const pet = await Pet.findByIdAndDelete(id);\n    if (!pet) {\n      return res.status(404).json({ error: 'Pet not found' });\n    }\n    const filePath = path.join(__dirname, '../images', pet.filename);\n\n    if (fs.existsSync(filePath)) {\n      fs.unlinkSync(filePath);\n    }\n\n    const transporter = nodemailer.createTransport({\n      service: 'gmail',\n      auth: {\n        user: process.env.EMAIL_USER,\n        pass: process.env.EMAIL_APP_PASS,\n      },\n    });\n\n    const mailOptions = {\n      from: process.env.EMAIL_USER,\n      to: pet.email,\n      subject: 'Pet Submission Removed - PetAdopt',\n      text: `Dear ${pet.status === 'HomePet' ? pet.name : pet.posterName},\\n\\nWe wanted to inform you that your pet submission has been removed from the Petadopt platform.\\n\\nIf you have any questions, please reach out to us.\\n\\nBest regards,\\nThe PetAdopt Team`,\n    };\n\n    try {\n      await transporter.sendMail(mailOptions);\n    } catch (error) {\n      console.error('Error sending removal email:', error);\n    }\n\n    res.status(200).json({ message: 'Pet deleted successfully' });\n  } catch (err) {\n    res.status(500).json({ error: err.message });\n  }\n};\n\nmodule.exports = {\n  postPetRequest,\n  approveRequest,\n  deletePost,\n  allPets,\n};\n"
        }
    ]
}